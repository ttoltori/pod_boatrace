name := 1T_01-04
//
attributes := 
  nationwiningrank_1:nominal, 
  nationwiningrank_2:nominal, 
  nationwiningrank_3:nominal, 
  nationwiningrank_4:nominal, 
  nationwiningrank_5:nominal, 
  nationwiningrank_6:nominal 
//
class_values := 
  1,2,3,4,5,6,else
//
sql := 
copy ( 
  select 
    substring(nationwiningrank from 1 for 1) nationwiningrank_1,
    substring(nationwiningrank from 2 for 1) nationwiningrank_2,
    substring(nationwiningrank from 3 for 1) nationwiningrank_3,
    substring(nationwiningrank from 4 for 1) nationwiningrank_4,
    substring(nationwiningrank from 5 for 1) nationwiningrank_5,
    substring(nationwiningrank from 6 for 1) nationwiningrank_6,
	( case tansyono 
	  when '1' then '1' 
	  when '2' then '2' 
	  when '3' then '3' 
	  when '4' then '4' 
	  when '5' then '5' 
	  when '6' then '6' 
	  else 'else' end ) 
  from 
  ( 
  select 
    race.ymd ymd1, race.jyocd jyocd1, race.raceno raceno1, race.*, waku.*, waku2.*, rgap.*, wakuwin.*, sgap.*, stat.* 
  from rec_race race, rec_race_waku waku, rec_race_waku2 waku2, rec_race_gap rgap, stat_race_gap sgap, stat_waku_win wakuwin, wrwaku_fame_rank3 rank3, stat_race stat 
  where race.ymd >= '{fromYmd}' and race.ymd <= '{toYmd}' 
    and tansyono not in ('特払','不成立','発売無') 
    and race.ymd = waku.ymd and race.jyocd = waku.jyocd and race.raceno = waku.raceno 
    and race.ymd = waku2.ymd and race.jyocd = waku2.jyocd and race.raceno = waku2.raceno 
    and race.ymd = rgap.ymd and race.jyocd = rgap.jyocd and race.raceno = rgap.raceno 
    and race.ymd = wakuwin.ymd and race.jyocd = wakuwin.jyocd   and race.raceno = wakuwin.raceno 
    and race.ymd = sgap.ymd and race.jyocd = sgap.jyocd and race.raceno = sgap.raceno 
    and race.ymd = stat.ymd and race.jyocd = stat.jyocd and race.raceno = stat.raceno 
    and race.ymd = rank3.ymd and race.jyocd = rank3.jyocd and race.raceno = rank3.raceno 
  ) tmp 
  ) to '{outfile}' with encoding 'UTF8' csv 
